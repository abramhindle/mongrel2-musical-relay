

\documentclass[titlepage,usenames,a4,landscape,semhelv]{seminar}
\newcommand{\presenter}{Abram Hindle}
\newcommand{\conference}{Toronto Perl Mongers August 2010}
\newcommand{\gettitle}{Web Based Computer Music UIs with Mongrel2 and Harbinger}
\newcommand{\getmaintitle}{\gettitle}

\newcommand{\gettitleproper}{\gettitle}
\newcommand{\names}{Abram Hindle}
\author{
\names \\ 
{\small Toronto  Perl Mongers} \\
abram.hindle@softwareprocess.es
}


\include{header}

\newcommand{\imageslide}[2]{
\newslide
\includegraphics[width=0.9\textwidth]{#2}
}

\newcommand{\figcaption}[1]{
\begin{center}
#1\\
\end{center}
}


\newcommand{\ig}[1]{\includegraphics{#1}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\pagestyle{fancy} %bars..
\begin{slide}

\begin{center}
{\bf \LARGE \getmaintitle }

{\names } 

{\small Toronto Perl Mongers} \\
abram.hindle@softwareprocess.es



\end{center}


=Introduction
* What if we could use familar interfaces to make music
* Could we co-opt other software and events to produce musical events?
* Could we even use web interfaces and use javascript UIs?

=Imagine
* Extending your spread sheet into a soundboard or drum kit
* Turning your paint program into a violin
* Sonifying a boring website like ebay
* Taking a flash game, a SVG program, or HTML5 program and using it as
computer music input.

=Lets Hijack Something
* JS1k (js1k.org) demos (now)
* Javascript programs (now)
* Websites

=What am I talking about
* Abram will now show a demo of filler creep sonified

=What was that?
* Javascript game using Canvas
* Instrumented to send XMLHttpRequests to a mongrel2 server
* Mongrel handler communicates to Harbinger
** Who munges messages, massages them and hands them to:
* CSound receives messages from Harbinger.

=Ok.. but how do we communicate from Gnumeric?
* Harbinger!
** C Library for sending messages
*** Just embed calls from within another program
** A middle man
*** receives these messages
*** Delegates messages to other programs like CSound

\newslide

\begin{figure}
  \centering
\includegraphics[width=\textwidth]{harbinger}  
\end{figure}


\newslide

\begin{figure}
  \centering
\includegraphics[width=\textwidth]{harbinger-example}
\end{figure}


=Harbinger
* send connectionless messages encoded in plain text
** UDP
* middle man routes these messages, and massages them
** Add code to the middle man to filter messages
* middle man passes messages on to other programs
 
=Why not OSC?
* OSC wasn't around or popular the time
* This is very simple
* This is very easy
* I can do more than OSC
* No errors if there is no one receiving the message
* Reduce dependencies.

=Gnumeric
* First configure and compile it
** \texttt{./configure --prefix=whereuwant it}
** \texttt{make \&\& make install}

=Gnumeric
* So we want to see when a cell is selected or when the current cell changes.
** grep for select, cell, update, change
* Cells are parts of sheets maybe look for that too

=Gnumeric
* Interesting procs
** scg\_object\_select
** scg\_cursor\_move
*** moves cursor down :(
*** but calls sv\_cursor\_set

=Gnumeric Guts
* look for sv\_cursor\_set
** src/sheet-view.c:sv\_cursor\_set
** sv\_cursor\_set does place the cursor 
*** sv\_set\_edit\_pos looks interesting though
** Lets change sv\_cursor\_set

=Gnumeric Debugging
* added code to src/sheet-view.c
** printed the view's current selection position
** Good
** This itself could be an instrument but I don't think it is enough

=Gnumeric: Get a Cell
* lets get a Cell Value
* Look in sheet-view.h, there must be a spreadsheet in there
** Yep sheet is in in sheet-view
** Lets look at sheet.h and see how to get a cell
*** \texttt{GnmCell  *sheet\_cell\_get(Sheet const *sheet, int col, int row);}
*** This looks good..

=Gnumeric: Cells
* Journey to gnumeric.h
** Where is \_GnmCell defined?
*** cell.h and cell.c
**** gnm\_cell\_get\_rendered\_text ?

=Gnumeric: Cells
* Added 
  \texttt{puts( gnm\_cell\_get\_rendered\_text( sheet\_cell\_get( sv->sheet,sv->edit\_pos.col, sv->edit\_pos.row)));}
** Got
\texttt{** (lt-gnumeric:5366): CRITICAL **: gnm\_cell\_get\_rendered\_text: assertion `cell != NULL' failed ERROR}
*** Although it did print values if it had them
*** Need to add a null check

=Gnumeric: Harbinger
* Now lets use the Harbinger API
* Remember to compile with -LHarbinger


=OpenArena
* Free datafiles
* IOQuake3 Engine

=Quake 3/IOQuake3/OpenArena
* Not the easiest to modify
** Contrary to existence of mods
* Useful events
** Gun fire
** Collisions
** Moving
** Rocket/Bullet Trails

=What to look for
* Sound system events
* Collision events
* Ricochets

=Quake 3 Arch notes
* Client and Server
* Game can be
** Native Game Code
** VM Code (QuakeC)
*** VM Code can't call POSIX :(

=Quake 3 Craziness
* To deal w/ the VM
** Anything that crosses the control/environment boundary
*** calls a syscall
* iD overloaded syscall with their own assembler based implementation
** wow 

=Quake 3
* Easiest for us to direct modify Quake3
* Compile to native code
* Ignore the VM

=Run IOQuake with our mods
*  \begin{verbatim}
     make && \
     cd ./build/release-linux-x86_64/ && \
     ./ioquake3.x86_64 +set sv_pure 0 \
     +set vm_cgame 0 +set vm_game 0 \ 
     +set vm_ui 0 +set s_initsound 0
\end{verbatim}


\begin{comment}
     Syscalls are good?
     openarena needs ioquake
     copy the baseq files to ioquake
     so openarena is for data files
     ioquake3 for code versio 1107 I think
     also applied some openarena patches
     to run quake I goto file:/home/abez/Desktop/quake3/ioquake3 and type
     make ; cd build/release-linux-x86_64/ ; ./*smp*64* +set s_initsound 0 ; cd .. ; cd ..
     our instrument:
     file:/home/abez/projects/Harbinger/quake3-2.pl
     cgame often gets compiled as a VM, we have to figure out how to compile cgame into a vm
     and then load it..
     essentially make a cgame mode
     then probably have a syscall which accesses it
     the server might have the same problem
     although shoving stuff in the server would make a lot of sense since it runs once.
     in client there is cg_syscall or something which catches syscalls then does a big case statement
     thus a true blue mod would probably help alot although it might limit the ability to play..
     a good idea would be to talk to ioquake people
     make && ./build/release-linux-x86_64/ioquake3.x86_64 +set sv_pure 0 +set vm_cgame 0 +set vm_game 0 +set vm_ui 0 +set s_initsound 0
     changed build to not make the vm..
     file:/home/abez/projects/Harbinger
     file:/projects/harbinger-quake3/quake3/ioquake3

\end{comment}

=Other suggestions
* GIMP, paint programs have nice UIs with lots of inform and tools.
* Instant Messaging
* follow strace
* follow tcpdump
* preload lib hooks and wrap calls


=Future Work
* Fish or Cut Bait?
** Work on music
** Work on tools?
** Restrictions versus freedom
* Other UIs

=Conclusions
* Take home:
** leverage the UIs of other software to produce music
*** avoid wasting your time reinventing the wheel
** Perl is the great glue that holds systems together
** avoiding complication helps for development speed
*** Hurts for performance (sometimes)


=
\end{slide}


\end{document}
